<!doctype html>
<html class="" lang="en">
  <head>
    <link rel="stylesheet" href="../styles/index_styles.css" />
    <link rel="stylesheet" href="../../assets/stylesheets/inter-font.css" />
    <script type="module" src="./index.js"></script>
    <script src="../../assets/js/tailwind.min.js"></script>
    <script>
      window.FontAwesomeConfig = { autoReplaceSvg: 'nest' };
    </script>
    <script src="../../assets/js/font-awesome.min.js"></script>
    <style>
      .fade-in {
        transition: opacity 0.3s ease;
      }

      .fade-in.hidden {
        display: none;
        opacity: 0;
      }

      .fade-in.fade-in {
        display: block;
        opacity: 1;
      }
    </style>
    <meta http-equiv="X-Content-Security-Policy" content="default-src 'self'; script-src 'self'" />
    <title>Monster Meter Calibration</title>
  </head>

  <body class="h-full text-base-content">
    <div id="app-container" class="min-h-screen bg-neutral-50">
      <header class="bg-white border-b border-neutral-200 fixed w-full z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
          <div class="flex items-center space-x-4">
            <h1 class="text-2xl font-semibold">Monster Meter Calibration</h1>
          </div>
        </div>
      </header>

      <main id="main" class="pt-16 container mx-auto px-4">
        <!-- Back Button -->
        <div class="mb-4 pt-2">
          <button
            id="back-button-monster-meter-calibration"
            class="flex items-center px-4 py-2 border border-neutral-300 bg-white text-neutral-700 rounded-md hover:bg-neutral-100 transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed"
          >
            <i class="fa-solid fa-arrow-left mr-2"></i> Back
          </button>

          <!-- Back Button Status Message (beneath button) -->
          <div id="back-button-status-message" class="mt-2">
            <div class="bg-neutral-100 border border-neutral-300 rounded-md px-3 py-2 flex items-center">
              <i class="fa-solid fa-info-circle text-neutral-600 mr-2"></i>
              <span id="back-button-message-text" class="text-neutral-800 text-sm font-medium"></span>
            </div>
          </div>
        </div>

        <div class="flex flex-col md:flex-row md:gap-x-8 mb-8 md:justify-between">
          <!-- Select Serial Port -->
          <div class="bg-white rounded-lg border border-neutral-200 p-6 w-full md:w-[500px] self-start">
            <label for="portSelect" class="block font-semibold mb-1"> Select Serial Port: </label>
            <div class="flex gap-2">
              <select id="portSelect" class="flex-1 mb-4 border border-neutral-300 rounded-lg px-3 py-2 pr-8 custom-select-arrow-left text-left">
                <option value="">Select Port</option>
              </select>
              <!-- <button id="refresh-ports-button" class="mb-4 px-3 py-2 border border-neutral-300 rounded-lg hover:bg-neutral-100" title="Refresh Ports">
                <i class="fa-solid fa-rotate-right"></i>
              </button> -->
            </div>

            <div class="flex justify-end mt-4">
              <button id="connect-monster-meter-port-button" class="px-4 py-2 bg-neutral-800 text-white rounded-lg hover:bg-neutral-700 transition duration-200 opacity-50 cursor-not-allowed" disabled>
                <i class="fa-solid fa-upload mr-2"></i> Connect
              </button>
            </div>
          </div>

          <!-- Available Sensors -->
          <div id="monster-meter-selection" class="bg-white rounded-lg border border-neutral-200 p-6 w-full md:w-[500px] hidden">
            <h2 class="mb-2 text-xl font-semibold">Available Sensor</h2>
            <div class="grid grid-cols-1 gap-4"></div>
          </div>
        </div>

        <section id="monster-meter-calibration-control" class="mb-2">
          <h2 class="text-xl font-semibold">Calibration Settings</h2>
          <p id="calibration-sub-text" class="text-sm italic text-black mb-0 mt-2">Please fill in all required fields ( * ) to start calibration.</p>
          <div class="flex items-center justify-between">
            <!-- Dropdowns Row -->
            <div class="flex gap-10 pt-2 pb-6">
              <!-- Tester Name Dropdown -->
              <div>
                <label for="tester-name" class="block text-sm font-medium text-neutral-700 mb-1">Tester Name<span class="text-red-500">*</span> </label>
                <select id="tester-name" class="border border-neutral-300 rounded-md pr-7 px-4 py-2 text-sm custom-select-arrow-left text-left">
                  <option value="">Select Tester Name</option>
                </select>
              </div>

              <!-- Model Dropdown -->
              <div>
                <label for="model-select" class="block text-sm font-medium text-neutral-700 mb-1">Model<span class="text-red-500">*</span> </label>
                <select id="model-select" class="border border-neutral-300 rounded-md pl-4 pr-6 py-2 text-sm custom-select-arrow-left text-left">
                  <option value="">Select Model</option>
                </select>
              </div>

              <!-- Serial Number Input -->
              <div>
                <label for="serial-number" class="block text-sm font-medium text-neutral-700 mb-1"> Serial Number<span class="text-red-500">*</span> </label>
                <input type="text" id="serial-number" class="border border-neutral-300 rounded-md px-3 py-2 text-sm w-40" placeholder="Enter serial number" />
              </div>
            </div>
          </div>
          <div class="flex items-center justify-between">
            <h2 class="text-xl font-semibold">Calibration Control</h2>
            <div class="flex gap-3">
              <button id="start-calibration-btn" class="rounded-md bg-black hover:bg-gray-800 px-4 py-2 text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <i class="fa-solid fa-play mr-2"></i>Start Calibration
              </button>
              <button id="stop-calibration-btn" class="rounded-md bg-red-600 hover:bg-red-700 px-4 py-2 text-white transition-colors font-bold text-[17px] w-[130px] hidden">
                <i class="fa-solid fa-stop mr-2"></i>STOP
              </button>
              <button id="start-verification-btn" class="rounded-md bg-black hover:bg-gray-800 px-4 py-2 text-white transition-colors disabled:opacity-50 disabled:cursor-not-allowed hidden" disabled>
                <i class="fa-solid fa-play mr-2"></i>Start Verification
              </button>
              <button id="stop-verification-btn" class="rounded-md bg-red-600 hover:bg-red-700 px-4 py-2 text-white transition-colors font-bold text-[17px] w-[130px] hidden">
                <i class="fa-solid fa-stop mr-2"></i>STOP
              </button>
            </div>
          </div>
        </section>

        <div class="grid gap-6 lg:grid-cols-2">
          <section id="monster-meter-pressure-readings" class="rounded-lg border bg-white p-6">
            <h2 class="mb-4 text-xl">Pressure Readings</h2>
            <div class="space-y-4">
              <div class="flex justify-between rounded-md bg-neutral-50 p-3">
                <span>Reference Pressure</span>
                <span id="monster-meter-reference-pressure-value">N/A</span>
              </div>
              <div class="flex justify-between rounded-md bg-neutral-50 p-3">
                <span>SensorHi Voltage (V)</span>
                <span id="live-monster-meter-sensorhi-voltage-value">N/A</span>
              </div>
              <div class="flex justify-between rounded-md bg-neutral-50 p-3">
                <span>SensorHi Pressure (PSI)</span>
                <span id="live-monster-meter-sensorhi-pressure-value">N/A</span>
              </div>
              <div class="flex justify-between rounded-md bg-neutral-50 p-3">
                <span>SensorLo Voltage (V)</span>
                <span id="live-monster-meter-sensorlo-voltage-value">N/A</span>
              </div>
              <div class="flex justify-between rounded-md bg-neutral-50 p-3">
                <span>SensorLo Pressure (PSI)</span>
                <span id="live-monster-meter-sensorlo-pressure-value">N/A</span>
              </div>
            </div>
          </section>

          <section id="monster-meter-calibration-log" class="rounded-lg border bg-white p-6">
            <h2 class="mb-4 text-xl">Calibration Logs</h2>
            <div id="monster-meter-calibration-log-content" class="h-[450px] overflow-y-auto rounded-md bg-neutral-900 p-4 text-sm text-white">
              <div id="monster-meter-log-messages" class="space-y-2">
                <!-- Log messages will be appended here -->
              </div>
            </div>
          </section>

          <section id="monster-meter-calibration-results" class="mt-6 rounded-lg border bg-white p-6 w-full col-span-full hidden">
            <!-- Tabs -->
            <div class="mb-4 flex space-x-2">
              <button id="monster-meter-tab-calibration" class="tab-button bg-neutral-900 text-white px-4 py-2 rounded">Calibration Results</button>
              <button id="monster-meter-tab-verification" class="tab-button bg-neutral-300 text-neutral-500 px-4 py-2 rounded cursor-not-allowed" disabled>Verification Results</button>
            </div>

            <!-- Tab Panels -->
            <div id="monster-meter-panel-calibration" class="tab-panel">
              <!-- Calibration Results Table -->
              <div class="mb-4">
                <h3 class="text-lg font-semibold mb-2">Calibration Results</h3>
                <div class="overflow-x-auto">
                  <table class="min-w-full border border-neutral-300">
                    <thead class="bg-neutral-100">
                      <tr>
                        <th class="border border-neutral-300 px-4 py-2 text-left">Point</th>
                        <th class="border border-neutral-300 px-4 py-2 text-left">Reference Pressure (PSI)</th>
                        <th class="border border-neutral-300 px-4 py-2 text-left">SensorHi Voltage (V)</th>
                        <th class="border border-neutral-300 px-4 py-2 text-left">SensorHi Pressure (PSI)</th>
                        <th class="border border-neutral-300 px-4 py-2 text-left">SensorLo Voltage (V)</th>
                        <th class="border border-neutral-300 px-4 py-2 text-left">SensorLo Pressure (PSI)</th>
                      </tr>
                    </thead>
                    <tbody id="calibration-results-tbody">
                      <!-- Calibration data will be populated here -->
                    </tbody>
                  </table>
                </div>
                <div id="calibration-progress-text" class="mt-2 text-sm text-neutral-600">Waiting for calibration data...</div>
              </div>
            </div>
            <div id="monster-meter-panel-verification" class="tab-panel">
              <!-- Verification Results Table -->
              <div class="mb-4">
                <div id="verification-progress-text" class="mt-3 text-sm text-gray-600 font-medium">Waiting for verification data...</div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- Alert Modal -->
    <div id="custom-alert" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center">
        <p id="custom-alert-message" class="mb-4 text-neutral-700"></p>
        <button id="custom-alert-ok" class="mt-2 px-8 py-2 bg-neutral-800 text-white rounded-lg hover:bg-neutral-700">OK</button>
      </div>
    </div>

    <!-- Error Alert Modal -->
    <div id="error-alert" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg p-6 max-w-sm w-full text-center">
        <div class="mb-4">
          <i class="fa-solid fa-exclamation-triangle text-red-500 text-4xl mb-2"></i>
          <p id="error-message" class="text-neutral-700"></p>
        </div>
        <button id="error-ok-btn" class="mt-2 px-8 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700">OK</button>
      </div>
    </div>
  </body>
</html>
